<script src="/resources/node_modules/chart.js/dist/Chart.min.js"></script>

{{>navigation}}
<div class="dt-content-wrapper">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h1 class="dt-page__title"><i class="icon icon-addnew dt-icon-bg bg-orange text-orange"></i> Legalizacion</h1>
            </div>
            <div class="col-md-6">
                <h1 class="dt-page__title">Personal</h1>
            </div>
        </div>
        <div class="dt-page-header">
            <br>
            <div class="row">
                 <a class="btn btn-primary btn-sm mr-2 mb-2" href="/legalizacion">
                    <div class="col">
                        Graficas
                    </div>
                </a>

                <a class="btn btn-primary btn-sm mr-2 mb-2" href="/legalizacion/personal">
                    <div class="col">
                        Personal
                    </div>
                </a>

                <a class="btn btn-primary btn-sm mr-2 mb-2" href="/legalizacion/agregar">
                    <div class="col">
                        Legalizar
                    </div>
                </a>
            </div>
            <br>
            {{#if personal}}
                <table class="table-planeacion table table-striped table-bordered table-hover display" style="margin-left: 20px">
                    <thead>
                        <tr>
                            <th class="text-center">Documento</th>
                            <th class="text-center">Nombre</th>
                            <th class="text-center">Teleono</th>
                            <th class="text-center">Profesion</th>
                            <th class="text-center">Consignaciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each consulta}}
                            <tr>
                                <td class="text-center">{{numero_documento_personal}}</td>
                                <td class="text-center">{{nombre_personal}} {{apellido_personal}}</td>
                                <td class="text-center">{{telefono_personal}}</td>
                                <td class="text-center">{{profesion_personal}}</td>
                                <td class="text-center">
                                    <a href="/legalizacion/consignacion?id_personal={{id}}" class="btn-eliminar-planeacion btn btn-success text-white dt-fab-btn">
                                        <i class="icon icon-eye icon-1x"></i>
                                    </a>
                                </td>
                            </tr>
                        {{/each}}
                    </tbody>
                </table>
            {{/if}}
            {{#if consignacion}}
                <table class="table-planeacion table table-striped table-bordered table-hover display" style="margin-left: 20px">
                    <thead>
                        <tr>
                            <th class="text-center">Consecutivo</th>
                            <th class="text-center">Fecha</th>
                            <th class="text-center">Descripcion</th>
                            <th class="text-center">Observaciones</th>
                            <th class="text-center">Estado</th>
                            <th class="text-center">Detalle</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each consulta}}
                            <tr>
                                <td class="text-center">{{id_consignacion}}</td>
                                <td class="text-center">{{fecha}}</td>
                                <td class="text-center">{{descripcion}}</td>
                                <td class="text-center">{{observaciones}}</td>
                                <td class="text-center">{{estado}}</td>
                                <td class="text-center">
                                    <a href="/legalizacion/detalle_consignacion?id_consignacion={{id_consignacion}}" class="btn-eliminar-planeacion btn btn-success text-white dt-fab-btn">
                                        <i class="icon icon-eye icon-1x"></i>
                                    </a>
                                </td>
                            </tr>
                        {{/each}}
                    </tbody>
                </table>
            {{/if}}
            {{#if detalleConsignacion}}
                
                <div class="row">
                    <div class="col">
                        <b>Fecha de solicitud: {{consulta1.fecha}}</b>
                    </div>
                    <div class="col">
                        <b>Monto Solicitado: <p style="display: inline;" id="monto"></p> </b>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <b>Nombre del solicitante: {{consulta1.solicitante}}</b>
                    </div>
                    <div class="col">
                        <b>Nombre beneficiario: {{consulta1.nombre_personal}} {{consulta1.apellido_personal}}</b>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <b>Servicio: {{consulta1.servicio}}</b>
                    </div>
                    <div class="col">
                        <b>Cedula beneficiario: {{consulta1.numero_documento_personal}}</b>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <b>Dias estimados de operacion: {{consulta1.dias}}</b>
                    </div>
                    <div class="col">
                        <b>Vehiculo/Equipo/Codigo dinamico: {{consulta1.trasporte}}</b>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <b>Cliente/Acumulador: {{consulta1.cliente}}</b>
                    </div>
                    <div class="col">
                        <b>Pozo/Centro de costos: {{consulta1.pozo}}</b>
                    </div>
                </div>
                
                <br>
                
                <table class="table table-striped table-bordered table-hover" style="margin-left: 20px">
                    <thead>
                        <tr>
                            <th class="text-center" colspan="2"></th>
                            <th class="text-center" colspan="3">Cotizacion</th>
                            <th class="text-center" colspan="3">Legalizacion</th>
                            <th class="text-center" id="consignacion">Consignacion: {{id_consignacion}}</th>
                        </tr>
                        <tr>
                            <th class="text-center">Item</th>
                            <th class="text-center">Concepto</th>
                            <th class="text-center">Cantidad</th>
                            <th class="text-center">Costo unitario</th>
                            <th class="text-center">Costo total</th>
                            <th class="text-center">Cantidad</th>
                            <th class="text-center">Costo unitario</th>
                            <th class="text-center">Costo total</th>
                            <th class="text-center">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each consulta}}
                            <tr>
                                <td class="text-center" id="item-{{idItem}}">{{idItem}}</td>
                                <td class="text-center" id="concepto-{{idItem}}">{{descripcionItem}}</td>
                                <td class="text-center" id="cCantidas-{{idItem}}">{{cdCantidad}}</td>
                                <td class="text-center" id="cCostoUnitario-{{idItem}}">{{cdValorUnitario}}</td>
                                <td class="text-center" id="cCostoTotal-{{idItem}}">{{cdCostoTotal}}</td>
                                <td class="text-center" id="lCantdad-{{idItem}}">{{lCantidad}}</td>
                                <td class="text-center" id="lCostoUnitario-{{idItem}}">{{lValorUnitario}}</td>
                                <td class="text-center" id="lCostoTotal-{{idItem}}">{{lValorUnitario}}</td>
                                <td class="text-center" id="total-{{idItem}}">0</td>
                            </tr>
                        {{/each}}
                        <tr>
                            <td class="text-center" colspan="4">Total</td>
                            <td class="text-center" id="cTotal">0</td>
                            <td class="text-center" colspan="2">Total</td>
                            <td class="text-center" id="lTotal">0</td>
                            <td class="text-center" id="tTotal">0</td>
                        </tr>
                    </tbody>
                </table>
            {{/if}}
        </div>
    </div>
</div>
{{#if detalleConsignacion}}
    <script>
        let resp = [];
        let sumaC = 0, sumaL = 0, sumaT = 0;
        let consignacion = $("#consignacion").text();
        let consignacionSplit = consignacion.split(": ");
        let data ={
            url: "http://localhost:4000/legalizacion/tabla",
            method: "POST",
            data: { id_consignacion : parseInt(consignacionSplit[1]) },
            dataType: "json"
        };
        $.ajax(data)
            .done(function(msg) {
                msg.resp.forEach(element => {
                    $(`#lCostoTotal-${element.idItem}`).text(
                        $(`#lCantdad-${element.idItem}`).text() * $(`#lCostoUnitario-${element.idItem}`).text()
                    );
                    $(`#total-${element.idItem}`).text(
                        $(`#cCostoTotal-${element.idItem}`).text() - $(`#lCostoTotal-${element.idItem}`).text()
                    );
                    sumaT += parseInt($(`#total-${element.idItem}`).text());
                    sumaC += parseInt($(`#cCostoTotal-${element.idItem}`).text());
                    sumaL += parseInt($(`#lCostoTotal-${element.idItem}`).text());
                });
                $("#tTotal").text(sumaT);
                $("#cTotal").text(sumaC);
                $("#lTotal").text(sumaL);
                $("#monto").text(sumaC);
            });
    </script>
{{/if}}