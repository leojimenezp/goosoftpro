<script src="/resources/node_modules/chart.js/dist/Chart.min.js"></script>

{{>navigation}}
<div class="dt-content-wrapper">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h1 class="dt-page__title"><i class="icon icon-addnew dt-icon-bg bg-orange text-orange"></i> Legalizacion</h1>
            </div>

            <div class="col-md-6">
                <h1 class="dt-page__title">Graficas</h1>
            </div>
        </div>
        <div class="dt-page-header">
            <br>
            <div class="row">
                <a class="btn btn-primary btn-sm mr-2 mb-2" href="/legalizacion">
                    <div class="col">
                        Graficas
                    </div>
                </a>

                <a class="btn btn-primary btn-sm mr-2 mb-2" href="/legalizacion/personal">
                    <div class="col">
                        Personal
                    </div>
                </a>

                <a class="btn btn-primary btn-sm mr-2 mb-2" href="/legalizacion/agregar">
                    <div class="col">
                        Legalizar
                    </div>
                </a>
            </div>
            <br>
            <div class="row">
                <div class="col-md-6">
                    <h1 class="dt-page__title">Consignaciones</h1>
                    <canvas id="myChart"></canvas>
                </div>
                <div class="col-md-6">
                    <h1 class="dt-page__title">Legalizaciones</h1>
                    <canvas id="myChart1"></canvas>
                </div>
                <div class="col-md-6">
                    <h1 class="dt-page__title">Costos deuda</h1>
                    <canvas id="myChart2"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    /*
        var cv = document.getElementById('chartJSContainer')
        var ctx = cv.getContext('2d');
        var chart = new Chart(ctx, options);
        cv.onclick = function(evt){
            var activePoint = chart.getElementAtEvent(evt);
            console.log('activePoint', activePoint)
            // var url = ... make link with data from activePoint
            window.location = 'https://www.google.by/search?q=chart+js+events&oq=chart+js+events'
        };
    */

    let cv = document.getElementById('myChart');
    let ctx = cv.getContext('2d');
    let chart = new Chart(ctx, {
        type: 'doughnut',
        data:{
            datasets: [{
                data: [{{consulta.aprobado}}, {{consulta.no_aprobado}}, {{consulta.rechazado}}],
                backgroundColor: ['green', 'orange','red'],
                label: 'Comparacion de navegadores'
            }],
            labels: ['aprobadas','no aprobadas','rechazadas']
        },
        options: {responsive: true}
    });

    cv.onclick = function(evt){
        let activePoint = chart.getElementAtEvent(evt);
        let index = activePoint[0]._index;
        let url = "http://localhost:4000/legalizacion/consignacion_grafica_consignacion"
        if(index == 0) window.location = url + '?estado=aprobado';
        else if(index == 1) window.location = url + '?estado=no aprobado';
        else if(index == 2) window.location = url + '?estado=rechazado';
    };

    let cv1 = document.getElementById('myChart1');
    let ctx1 = cv1.getContext('2d');
    let chart1 = new Chart(ctx1, {
        type: 'doughnut',
        data:{
            datasets: [{
                data: [{{consulta1.legalizado}}, {{consulta1.no_legalizado}}],
                backgroundColor: ['green', 'red'],
                label: 'Comparacion de navegadores'
            }],
            labels: ['legalizadas','no legalizadas']
        },
        options: {responsive: true}
    });

    cv1.onclick = function(evt){
        let activePoint = chart1.getElementAtEvent(evt);
        let index = activePoint[0]._index;
        let url = "http://localhost:4000/legalizacion/consignacion_grafica_legalizada"
        if(index == 0) window.location = url + '?estado=1';
        else if(index == 1) window.location = url + '?estado=0';
    };

    let cv2 = document.getElementById('myChart2');
    let ctx2 = cv2.getContext('2d');
    let chart2 = new Chart(ctx2, {
        type: 'doughnut',
        data:{
            datasets: [{
                data: [{{consulta2.persona}}, {{consulta2.empresa}}],
                backgroundColor: ['green', 'red'],
                label: 'Comparacion de navegadores'
            }],
            labels: ['Deuda persona','Deuda empresa']
        },
        options: {responsive: true}
    });

    cv2.onclick = function(evt){
        let activePoint = chart2.getElementAtEvent(evt);
        console.log(activePoint);
        let index = activePoint[0]._index;
        console.log(index);
        let url = "http://localhost:4000/legalizacion/consignacion_grafica_deuda"
        if(index == 0) window.location = url + '?estado=persona';
        else if(index == 1) window.location = url + '?estado=empresa';
    };
</script>